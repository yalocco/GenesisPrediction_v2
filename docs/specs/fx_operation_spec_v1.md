# FX運用仕様書（GenesisPrediction v2）

## 目的
本ドキュメントは、GenesisPrediction v2 における **FX（為替）系ルーティーンの設計思想・処理フロー・生成物・判断基準** を文章として固定化するものである。

本仕様は、
- 人間（将来の自分／第三者）
- AI（別セッション・別モデル・自動解析）

のいずれが読んでも **「何が行われ、何を見ればよいか」** が理解できることを目的とする。

---

## 基本思想（最重要）

### 1. FX系は「判断補助システム」である

GenesisPrediction v2 における FX 系は、
- 未来の価格を当てる
- トレードを自動化する

ことを目的としない。

**目的は以下に限定される：**
- 仕送り・送金の「実行タイミング」を誤らない
- ノイズが高い日に「無理をしない」
- 判断を感情から切り離す

---

### 2. 可視化（チャート）は“説明用”、判断は“ログ”で行う

- チャート（PNG）
  - 状況把握・説明・後追い確認用
- テキストログ（fx_today / fx_summary）
  - **実際の判断根拠（正本）**

👉 チャートが最新日まで描画されていなくても **異常ではない**。

---

## データフロー全体像

```
CSV（実データ）
  ↓
fx_remittance_today.py   ← 当日の判断
  ↓
fx_remittance_summary.py ← 直近30日の傾向
  ↓
fx_remittance_overlay.py ← 可視化（PNG生成）
  ↓
GUI（画像一覧 + ログ表示）
```

---

## 使用データ

### 正本CSV

```
data/fx/jpy_thb_remittance_dashboard.csv
```

- 日次で追記される
- 為替市場の営業日に依存
- 朝イチは「前営業日止まり」が普通

**重要：**
- CSVに存在しない日付は「未来」ではなく「未取得」
- 可視化が止まるのは正常動作

---

## 各スクリプトの役割

### 1. fx_remittance_today.py

**役割：**
- 当日の送金判断を行う

**主な出力：**
- decision（ON / WARN / OFF）
- noise
- recommended_action（send_normal / split / wait 等）
- reason（日本語コメント）

**判断はここで完結する。**

---

### 2. fx_remittance_summary.py

**役割：**
- 直近30日間の傾向を要約

**出力例：**
- ON / WARN / OFF 比率
- 平均ノイズ
- 推奨アクションの内訳
- 総評（日本語）

👉 「最近どういう相場か」を一文で理解するための補助。

---

### 3. fx_remittance_overlay.py

**役割：**
- CSVを元に PNG グラフを生成

**特徴：**
- MA / Band / 判定点（ON/WARN/OFF）を描画
- マウス操作（ズーム・パン）は matplotlib 標準
- 未来日は描画しない

**保存先：**
```
data/fx/*.png
```

---

## GUI における扱い

### 表示方針

- FX セクションでは以下を表示
  - 最新の判断ログ
  - 生成された PNG 一覧（新しい順）

- GUI は以下を行わない
  - 価格計算
  - 補間
  - 未来予測

👉 **GUI は完全に受動的なビューア**

---

## よくある挙動とその解釈

### Q. チャートが数日分先まで出ない

A. 正常。
- CSVの最終日までしか描画しない設計
- 朝イチ・休日は特に起きやすい

---

### Q. 判断は出ているのにチャートが古い

A. 問題なし。
- 判断はノイズ計算に基づく
- チャートは説明用

---

## 運用ルーティーン（確定）

### 毎日やること

1. GUI を開く
2. 「Run daily」または「Run FX」を押す
3. **テキストログを読む**
4. チャートは参考程度に確認

---

## 設計上の原則（将来変更禁止）

- 可視化に判断ロジックを入れない
- データが無い日を“埋めない”
- 人間が読める日本語ログを必ず残す
- 判断は必ずスクリプト側で完結させる

---

## 結論

この FX 系は：
- 再現可能
- 説明可能
- 属人化しない

**「静かに、間違えない判断を支える仕組み」**として完成している。

今後 AI が引き継いでも、
人間が久しぶりに見ても、
この仕様書があれば迷わない。

---

（GenesisPrediction v2 / FX Operation Spec v1）

